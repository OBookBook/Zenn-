---
title: "ã‚µã‚¯ãƒƒã¨ä½œã‚Œã‚‹PHPæ§‹ç¯‰(Docker/MySQL/phpMyAdmin/Composer/Xdebug/PHP_CodeSniffer)"
emoji: "ğŸ‘»"
type: "tech"
topics:
  - "docker"
  - "vscode"
  - "php"
  - "composer"
  - "xdebug"
published: true
---

## ç’°å¢ƒæ¦‚è¦

- Docker
- PHP:8.2-apache
- MySQL:8.0
- phpMyAdmin:latest
- VSCode
- Xdebug
- Composer
- PHP_CodeSniffer

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®GitHubãƒªãƒã‚¸ãƒˆãƒª

GitHubãƒªãƒã‚¸ãƒˆãƒªï¼š[https://github.com/OBookBook/php-docker-env](https://github.com/OBookBook/php-docker-env)
GitHubã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚‹ã«ã¯ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

```shell
git clone https://github.com/OBookBook/php-docker-env.git
```

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š

```
â”œâ”€â”€ .vscode
â”‚   â””â”€â”€ launch.json # VSCodeãƒ‡ãƒãƒƒã‚°æ§‹æˆã‚’å®šç¾©ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆxdebugè¨­å®šï¼‰
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ README.md
â”œâ”€â”€ composer.json # PHP_CodeSnifferã®è¨­å®š
â”œâ”€â”€ docker-compose.yml # Dockerã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã¨php.iniã®ãƒã‚¦ãƒ³ãƒˆ
â”œâ”€â”€ index.php
â””â”€â”€ php.ini # Xdebugã®è¨­å®š
```

## Dockerã®è¨­å®š
### docker-compose.ymlã‚’ä½œæˆ
docker-compose.ymlãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€ä»¥ä¸‹ã®é …ç›®ã‚’å„è‡ªã®ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ³¨æ„ã‚’æ€ ã‚‰ãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚
```yaml
version: "3.7"
services:
  db:
    image: mysql:8.0
    container_name: mysql
    restart: always
    environment:
      # ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å„è‡ªã§è¨­å®šã—ã¦ãã ã•ã„
      MYSQL_ROOT_PASSWORD: root_password_kimetene
      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åã‚’å„è‡ªã§è¨­å®šã—ã¦ãã ã•ã„
      MYSQL_DATABASE: db_local
      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ¦ãƒ¼ã‚¶åã‚’å„è‡ªã§è¨­å®šã—ã¦ãã ã•ã„
      MYSQL_USER: db_user
      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å„è‡ªã§è¨­å®šã—ã¦ãã ã•ã„
      MYSQL_PASSWORD: db_password_kimetene
  php:
    build: ./
    container_name: php
    volumes:
      - ./php.ini:/usr/local/etc/php/php.ini
      - ./:/var/www/html
    ports:
      - 9080:80
    depends_on:
      - db
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: phpmyadmin
    restart: always
    depends_on:
      - db
    ports:
      - 9090:80
```

### Dockerfileã‚’ä½œæˆ
Dockerfileã‚’ç·¨é›†ã—ã€ä»¥ä¸‹ã®å†…å®¹ã«å¾“ã£ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚
```Dockerfile
FROM php:8.2-apache

# xdebug ç’°å¢ƒæ§‹ç¯‰
RUN pecl install xdebug && \
  docker-php-ext-enable xdebug

# Docker å…¬å¼ã® Composer ã‚¤ãƒ¡ãƒ¼ã‚¸ ã‚’ä½¿ç”¨
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Composer ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã™ã‚‹ç‚ºã®ç’°å¢ƒæ§‹ç¯‰
RUN apt-get update && \
  apt-get install -y sudo git
# Composerã®è¨­å®š
RUN echo 'export PATH="$PATH:/root/.composer/vendor/bin"' >> /root/.bashrc
# Composerã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢
RUN composer global clear-cache

# php_codesniffer ã‚’ä½¿ã†ãŸã‚ã®ç’°å¢ƒæ§‹ç¯‰
RUN composer global require --no-interaction "squizlabs/php_codesniffer=*" && \
  composer require --dev --no-interaction squizlabs/php_codesniffer
```

## Compoerã®è¨­å®š
### composer.jsonã‚’ä½œæˆ (php_codesniffer)
composer.jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚
PHP_CodeSnifferã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ï¼š
```json
{
    "require-dev": {
        "squizlabs/php_codesniffer": "^3.7"
    }
}
```

## xdebugã®è¨­å®š
### php.iniã‚’ä½œæˆ
php.iniãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦Xdebugã®è¨­å®šã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã¯Xdebugã®è¨­å®šä¾‹ã§ã™ï¼š
```ini
[xdebug]
xdebug.client_host = host.docker.internal
xdebug.mode = debug
xdebug.start_with_request = yes
xdebug.discover_client_host = 0
xdebug.remote_handler = "dbgp"
xdebug.client_port = 9003
```

### VSCodeã§æ‹¡å¼µæ©Ÿèƒ½ã€ŒPHP Debugã€ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
PHP Debugã§æ¤œç´¢ã—ã¦ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚
![](https://storage.googleapis.com/zenn-user-upload/bb693b4ca30d-20231029.png)

### VSCodeã§ã€Œlaunch.jsonã€ã‚’ä½œæˆ
VSCodeã®å·¦å´ã«ã‚ã‚‹ãƒ‡ãƒãƒƒã‚°ãƒœã‚¿ãƒ³ãŒå‡ºç¾ã—ã¾ã™ã€‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¦ã€launch.jsonã‚’ä½œæˆã—ã¦ä¸‹ã•ã„ã€‚
![](https://storage.googleapis.com/zenn-user-upload/bc3dfb224540-20231029.png)

### launch.jsonã§xdebugã®è¨­å®š
Dockerã§ä½œæˆã™ã‚‹é–‹ç™ºã‚³ãƒ³ãƒ†ãƒŠã¨xdebugã‚’ç¹‹ã’ã¦ã¾ã™ã€‚è©³ã—ã„äº‹ã¯ã‚³ãƒ¡ãƒ³ãƒˆã®é€šã‚Šã§ã™ã€‚
```json
    {
      "name": "Listen for Xdebug",
      "type": "php",
      "request": "launch",
      // php.iniãƒ•ã‚¡ã‚¤ãƒ«ã®xdebug.client_port = 9003 ã¨åŒã˜PORTã‚’æŒ‡å®šã—ã¦ä¸‹ã•ã„!
      "port": 9003,
      // XdebugãŒå‹•ã‹ãªã‹ã£ãŸã‚‰ã€PATHã®è¨­å®šã‚’è¦‹ç›´ã—ã¦ã¿ã¦ä¸‹ã•ã„ï¼
      "pathMappings": {
        "/var/www/html": "${workspaceRoot}"
        // "/var/www/html": "c:/Users/***/***/***/***/***/" çµ¶å¯¾ãƒã‚¹ã§æŒ‡å®šã—ãŸã‚‰ç¢ºå®Ÿã«å‹•ãã¾ã™ã€‚
      }
    }
```

## ä½¿ã„æ–¹

### Dockerãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ç§»å‹•
1. Dockerã‚’èµ·å‹•ã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚
```shell
docker-compose up -d
```

### Webã‚µãƒ¼ãƒãŒæ­£å¸¸ã«å‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèª
ã“ã‚Œã¯ç§ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®index.phpãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/73bd365d50f6-20231029.png)
2. ä»¥ä¸‹ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š[http://localhost:9080/](http://localhost:9080/)

### phpMyAdminãŒæ­£å¸¸ã«å‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèª
![](https://storage.googleapis.com/zenn-user-upload/ab6f97676c59-20231029.png)
3. ä»¥ä¸‹ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š[http://localhost:9090/](http://localhost:9090/)

### Dockerã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³
4. Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã«å…¥ã‚‹ãŸã‚ã«ã€æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
```shell
docker container exec -it php bash
```

### composerã§php_codesnifferã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
5. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
```shell
composer install
```

### é™çš„è§£æãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†
6. PHP_CodeSnifferã‚’ä½¿ç”¨ã—ã¦PSR-12ã®é™çš„è§£æã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
```shell
./vendor/bin/phpcs --standard=PSR12 ./index.php
```

### xdebugã‚’ä½¿ã£ã¦ã¿ã‚ˆã†
7. VSCodeã§ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œ
![](https://storage.googleapis.com/zenn-user-upload/a4a009797151-20231029.png)
Xdebugã‚’æ´»ç”¨ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®æ‰‹é †ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š
  1. index.phpã«ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è²¼ã‚‹
  2. VSCodeã§ãƒ‡ãƒãƒƒã‚°å®Ÿè¡Œã‚’æŠ¼ã™
  3. ãƒ—ãƒ©ã‚¦ã‚¶ã‹ã‚‰index.phpã‚’å©ã!!
ä»¥ä¸‹ã®URLã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ï¼š[http://localhost:9080/](http://localhost:9080/)
